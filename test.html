<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hexapod Pack Opener</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 50%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            /* Disable text/image selection */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* Disable drag and drop */
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(235, 252, 0, 0.8) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 15s infinite linear;
            will-change: transform;
        }

        @keyframes float {
            from {
                transform: translateY(100vh) translateX(0) translateZ(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            to {
                transform: translateY(-100vh) translateX(100px) translateZ(0);
                opacity: 0;
            }
        }

        /* White flash overlay for pack opening */
        .flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.2) 70%, transparent 100%);
            opacity: 0;
            pointer-events: none;
            z-index: 999;
            will-change: opacity, transform;
        }

        .flash-overlay.active {
            animation: flashExplosion 1.5s ease-out forwards;
        }

        @keyframes flashExplosion {
            0% {
                opacity: 0;
                transform: scale(0.1);
            }
            30% {
                opacity: 1;
                transform: scale(1.2);
            }
            70% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(1);
            }
        }

        .container {
            width: 100%;
            max-width: 600px;
            padding: 30px;
            text-align: center;
            position: relative;
            z-index: 10;
            perspective: 1000px;
            transform: scale(1.2);
        }

        .title {
            color: #7cfc00;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(124, 252, 0, 0.5),
                         0 0 40px rgba(124, 252, 0, 0.3);
            animation: pulse 2s ease-in-out infinite;
            transition: all 0.3s ease;
            min-height: 35px;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .title.card-name {
            animation: none;
            color: #fff;
        }

        .title.card-name.common {
            text-shadow: 0 0 20px rgba(150, 150, 150, 0.8);
        }

        .title.card-name.uncommon {
            color: #0096ff;
            text-shadow: 0 0 20px rgba(0, 150, 255, 0.8);
        }

        .title.card-name.legendary {
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8),
                         0 0 60px rgba(255, 215, 0, 0.5);
            animation: legendaryPulse 1s ease-in-out infinite;
        }

        @keyframes legendaryPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .pack-container {
            position: relative;
            width: 200px;
            height: 280px;
            margin: 0 auto 30px;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
        }

        .pack-container:hover {
            transform: rotateY(10deg) rotateX(-10deg) translateZ(20px);
        }

        .pack {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: all 0.3s ease;
        }

        .pack:hover {
            filter: brightness(1.2) drop-shadow(0 0 30px rgba(252, 214, 0, 0.5));
        }

        /* 3D Canvas for GLB model */
        .pack-3d-canvas {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            /* Disable canvas interactions */
            pointer-events: none;
        }

        /* Mobile-optimized pack opening animation */
        .pack.opening {
            animation: packOpenMobile 1.2s ease-out forwards;
            will-change: transform, opacity;
        }

        @keyframes packOpenMobile {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            40% {
                transform: scale(1.3) rotate(10deg);
                opacity: 1;
            }
            70% {
                transform: scale(2) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                transform: scale(4) rotate(360deg);
                opacity: 0;
            }
        }

        /* Simplified energy rings for mobile */
        .energy-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border: 2px solid rgba(252, 193, 0, 0.8);
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
            will-change: transform, opacity;
        }

        .energy-ring.active {
            animation: energyExpandMobile 1s ease-out forwards;
        }

        @keyframes energyExpandMobile {
            0% {
                width: 100px;
                height: 100px;
                opacity: 1;
            }
            100% {
                width: 400px;
                height: 400px;
                opacity: 0;
            }
        }

        .card-display {
            display: none;
            position: relative;
            width: 250px;
            height: 350px;
            margin: 0 auto;
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #0f0f1e);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
            cursor: pointer;
            will-change: transform;
        }

        .card:hover {
            transform: rotateY(10deg) rotateX(-10deg) scale(1.05);
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.9),
                        0 0 80px rgba(255, 255, 255, 0.6);
        }


        .card-back {
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #2d5016 0%, #0f1f05 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #fcb900;
            font-weight: bold;
            backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
        }

        .card-front {
            width: 100%;
            height: 100%;
            transform: rotateY(180deg);
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 15px;
            overflow: hidden;
            backface-visibility: hidden;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
            /* Disable image interactions */
            pointer-events: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
            -webkit-user-drag: none;
            -moz-user-drag: none;
            user-drag: none;
        }

        .rarity-glow {
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border-radius: 25px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .card.common .rarity-glow {
            background: radial-gradient(ellipse at center, rgba(150, 150, 150, 0.8), transparent);
            animation: commonGlow 2s ease-in-out infinite;
        }

        .card.uncommon .rarity-glow {
            background: radial-gradient(ellipse at center, rgba(0, 150, 255, 0.8), transparent);
            animation: uncommonGlow 2s ease-in-out infinite;
        }

        .card.legendary .rarity-glow {
            background: radial-gradient(ellipse at center, rgba(255, 215, 0, 1), rgba(255, 150, 0, 0.5), transparent);
            animation: legendaryGlow 1s ease-in-out infinite;
        }

        .card.flipped .rarity-glow {
            opacity: 1;
        }

        @keyframes commonGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(150, 150, 150, 0.5); }
            50% { box-shadow: 0 0 40px rgba(150, 150, 150, 0.8); }
        }

        @keyframes uncommonGlow {
            0%, 100% { box-shadow: 0 0 30px rgba(0, 150, 255, 0.6); }
            50% { box-shadow: 0 0 50px rgba(0, 150, 255, 0.9); }
        }

        @keyframes legendaryGlow {
            0%, 100% { 
                box-shadow: 0 0 40px rgba(255, 215, 0, 0.8),
                           0 0 80px rgba(255, 215, 0, 0.6),
                           0 0 120px rgba(255, 215, 0, 0.4);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 60px rgba(255, 215, 0, 1),
                           0 0 100px rgba(255, 215, 0, 0.8),
                           0 0 140px rgba(255, 215, 0, 0.6);
                transform: scale(1.02);
            }
        }

        /* Card slam animation - optimized */
        .card-slam {
            animation: cardSlam 0.8s cubic-bezier(0.4, 0.0, 0.2, 1) forwards;
            will-change: transform, opacity;
        }

        @keyframes cardSlam {
            0% {
                transform: translateY(-150vh) scale(0.3) rotateZ(720deg) translateZ(0);
                opacity: 0;
            }
            60% {
                transform: translateY(20px) scale(1.1) rotateZ(5deg) translateZ(0);
                opacity: 1;
            }
            80% {
                transform: translateY(-5px) scale(0.95) rotateZ(-2deg) translateZ(0);
            }
            100% {
                transform: translateY(0) scale(1) rotateZ(0deg) translateZ(0);
            }
        }

        /* Legendary card special entrance - optimized */
        .card.legendary.card-slam {
            animation: legendarySlam 1.5s cubic-bezier(0.4, 0.0, 0.2, 1) forwards;
        }

        @keyframes legendarySlam {
            0% {
                transform: translateY(-200vh) scale(0.1) rotateZ(1440deg) translateZ(0);
                opacity: 0;
                filter: brightness(3) hue-rotate(0deg);
            }
            40% {
                transform: translateY(-50px) scale(1.5) rotateZ(360deg) translateZ(0);
                opacity: 1;
                filter: brightness(2) hue-rotate(180deg);
            }
            60% {
                transform: translateY(30px) scale(1.2) rotateZ(10deg) translateZ(0);
                filter: brightness(1.5) hue-rotate(360deg);
            }
            80% {
                transform: translateY(-10px) scale(0.9) rotateZ(-5deg) translateZ(0);
                filter: brightness(1.2) hue-rotate(0deg);
            }
            100% {
                transform: translateY(0) scale(1) rotateZ(0deg) translateZ(0);
                filter: brightness(1) hue-rotate(0deg);
            }
        }

        /* Lightning effect for legendary cards */
        .lightning {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        .lightning.active {
            display: block;
        }

        .lightning-bolt {
            position: absolute;
            width: 2px;
            height: 100%;
            background: linear-gradient(to bottom, transparent, #fff, transparent);
            opacity: 0;
            animation: lightning 0.3s ease-out forwards;
            will-change: opacity, transform;
        }

        @keyframes lightning {
            0% {
                opacity: 0;
                transform: scaleY(0);
            }
            50% {
                opacity: 1;
                transform: scaleY(1);
            }
            100% {
                opacity: 0;
                transform: scaleY(1);
            }
        }

        /* Screen shake for legendary */
        @keyframes screenShake {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-5px, 5px); }
            20% { transform: translate(5px, -5px); }
            30% { transform: translate(-3px, 3px); }
            40% { transform: translate(3px, -3px); }
            50% { transform: translate(-2px, 2px); }
            60% { transform: translate(2px, -2px); }
            70% { transform: translate(-4px, 4px); }
            80% { transform: translate(4px, -4px); }
            90% { transform: translate(-1px, 1px); }
        }

        .screen-shake {
            animation: screenShake 0.5s ease-out;
        }

        .click-hint {
            position: absolute;
            bottom: -60px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            pointer-events: none;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        .all-cards-display {
            display: none;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            padding: 20px;
        }

        .small-card {
            width: 120px;
            height: 168px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            position: relative;
            opacity: 0;
            animation: cardFadeIn 0.5s ease-out forwards;
            transform-style: preserve-3d;
        }

        @keyframes cardFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.8) translateZ(0);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1) translateZ(0);
            }
        }

        .small-card:hover {
            transform: scale(1.15) translateY(-10px) rotateZ(2deg) translateZ(20px);
            z-index: 100;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
        }

        .small-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
            /* Disable image interactions */
            pointer-events: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
            -webkit-user-drag: none;
            -moz-user-drag: none;
            user-drag: none;
        }

        .small-card.legendary {
            animation: cardFadeIn 0.5s ease-out forwards, legendaryFloat 3s ease-in-out infinite;
        }

        @keyframes legendaryFloat {
            0%, 100% { transform: translateY(0) translateZ(0); }
            50% { transform: translateY(-5px) translateZ(0); }
        }

        .burst-particles {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
        }

        .burst-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: burst 1s ease-out forwards;
            will-change: transform, opacity;
        }

        @keyframes burst {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }

        .locked-message {
            color: #ff4444;
            font-size: 16px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 68, 68, 0.1);
            border: 2px solid #ff4444;
            border-radius: 10px;
        }

        /* Legendary announcement */
        .legendary-announcement {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8),
                         0 0 60px rgba(255, 215, 0, 0.6),
                         0 0 90px rgba(255, 215, 0, 0.4);
            opacity: 0;
            pointer-events: none;
            z-index: 1001;
            will-change: transform, opacity;
        }

        .legendary-announcement.show {
            animation: legendaryAnnounce 2s ease-out forwards;
        }

        @keyframes legendaryAnnounce {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
                letter-spacing: 20px;
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.5);
                letter-spacing: 5px;
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1);
                letter-spacing: 2px;
            }
        }

        /* Loading indicator for 3D model */
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #7cfc00;
            font-size: 14px;
            display: none;
        }

        .loading-indicator.show {
            display: block;
        }

        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid rgba(124, 252, 0, 0.3);
            border-top: 3px solid #7cfc00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/loaders/GLTFLoader.js"></script>

    <script>
        // Image protection measures (disabled in debug mode)
        (function() {
            'use strict';
            
            const urlParams = new URLSearchParams(window.location.search);
            const debugMode = urlParams.get('debug') === 'true';
            
            if (!debugMode) {
                // Disable right-click context menu
                document.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    return false;
                });
                
                // Disable common keyboard shortcuts for dev tools and saving
                document.addEventListener('keydown', function(e) {
                    // F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U, Ctrl+S, Ctrl+A, Ctrl+P
                    if (e.keyCode === 123 || 
                        (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||
                        (e.ctrlKey && (e.keyCode === 85 || e.keyCode === 83 || e.keyCode === 65 || e.keyCode === 80))) {
                        e.preventDefault();
                        return false;
                    }
                });
            }
            
            // Disable drag and drop on all images
            document.addEventListener('dragstart', function(e) {
                if (e.target.tagName === 'IMG') {
                    e.preventDefault();
                    return false;
                }
            });
            
            // Additional protection against image theft
            document.addEventListener('selectstart', function(e) {
                if (e.target.tagName === 'IMG') {
                    e.preventDefault();
                    return false;
                }
            });
            
            // Override the normal image loading for card images
            window.setProtectedImage = function(imgElement, src) {
                imgElement.src = src;
                
                // Add additional layer - make images unselectable
                imgElement.style.webkitUserSelect = 'none';
                imgElement.style.mozUserSelect = 'none';
                imgElement.style.msUserSelect = 'none';
                imgElement.style.userSelect = 'none';
                imgElement.draggable = false;
            };
            
        })();
        
        // REPLACE THESE WITH YOUR OWN ASSETS
        const PACK_GLB_MODEL = 'HexapodTCGPack.glb'; // Replace with your GLB file path
        
        // Card collection with rarity and image URLs
        const CARD_COLLECTION = {
            common: [
                { name: 'The Soldier Ant', image: 'bugs_card/ant.png' },
                { name: 'The House Spider', image: 'bugs_card/spider.png'},
                { name: 'The Bumble Bee', image: 'bugs_card/bee.png'},
                { name: 'The Pill Bug', image: 'bugs_card/pill.png'},
                { name: 'The Grass Hopper', image: 'bugs_card/cricket.png'},
            ],
            uncommon: [
                { name: 'The Tiger Beetle', image: 'bugs_card/tiger.png' },
                { name: 'The Black Beetle', image: 'bugs_card/blackbeetle.png' },
                { name: 'The Diving Bell Spider', image: 'bugs_card/divingbell.png' },
                { name: 'The Dung Beetle', image: 'bugs_card/dungbeetle.png' },
                { name: 'The Mole Cricket', image: 'bugs_card/mole.png' },
                { name: 'The Wasp', image: 'bugs_card/wasp.png' },
            ],
            legendary: [
                { name: 'The Praying Mantis', image: 'bugs_card/mantis.png' },
                { name: 'The Dragon Fly', image: 'bugs_card/dragon.png' },
                { name: 'The Rhino Beetle', image: 'bugs_card/rihno.png' },
            ]
        };

        // Rarity chances (must add up to 100)
        const RARITY_CHANCES = {
            common: 75,     // ~74% chance
            uncommon: 23,   // ~23% chance
            legendary: 2      // 3% chance
        };

        // Audio settings
        const AUDIO_SETTINGS = {
            // Replace these URLs with your own audio files
            backgroundMusic: 'sfx/backtrack.mp3',
            packOpen: 'sfx/tcg pack open.mp3', // Placeholder
            cardSlam: 'sfx/Card Deal 2.wav', // Placeholder
            commonReveal: 'sfx/card_deal.mp3', // Placeholder
            uncommonReveal: 'sfx/card_deal.mp3', // Placeholder
            legendaryReveal: 'sfx/card_deal.mp3', // Placeholder
            legendaryAnoucement: 'sfx/legendary annoucement.mp3', // Placeholder.  balatro/holo1.ogg
            uncommonAnoucement: 'sfx/uncommon.mp3',
            allCardsReveal: 'sfx/cardflips.mp3', // Placeholder
            allCardsReveal_withLegendary: '' // Placeholder
        };
    </script>

    <div class="particles" id="particles"></div>
    <div class="flash-overlay" id="flashOverlay"></div>
    <div class="lightning" id="lightning"></div>
    <div class="legendary-announcement" id="legendaryAnnouncement">LEGENDARY!</div>
    
    <div class="container" id="mainContainer">
        <h1 class="title" id="title">Open Your Daily Pack!</h1>
        
        <div class="pack-container" id="packContainer">
            <div class="pack" id="pack">
                <canvas class="pack-3d-canvas" id="pack3DCanvas"></canvas>
                <div class="loading-indicator" id="loadingIndicator">
                    <div class="spinner"></div>
                    Loading 3D Model...
                </div>
            </div>
            <div class="energy-ring" id="energyRing1"></div>
            <div class="energy-ring" id="energyRing2"></div>
            <div class="energy-ring" id="energyRing3"></div>
        </div>
        
        <div class="card-display" id="cardDisplay">
            <div class="card" id="currentCard">
                <div class="rarity-glow"></div>
                <img src="" id="cardImage" class="card-image" alt="Card">
            </div>
            <div class="click-hint">Click card to continue</div>
        </div>
        
        <div class="all-cards-display" id="allCardsDisplay"></div>
        
        <div class="locked-message" id="lockedMessage" style="display: none;">
            You've already opened your daily pack! Come back tomorrow for more cards.
        </div>
    </div>

    <script>
        // 3D Model Manager
        class Pack3DViewer {
            constructor(canvasId, modelUrl) {
                this.canvas = document.getElementById(canvasId);
                this.modelUrl = modelUrl;
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.model = null;
                this.isLoaded = false;
                this.animationId = null;
                this.clock = new THREE.Clock();
                
                this.init();
                this.loadModel();
            }

            init() {
                // Scene setup
                this.scene = new THREE.Scene();
                
                // Camera setup
                this.camera = new THREE.PerspectiveCamera(
                    50, 
                    this.canvas.offsetWidth / this.canvas.offsetHeight, 
                    0.1, 
                    1000
                );
                this.camera.position.set(0, 0, 5);
                
                // Renderer setup
                this.renderer = new THREE.WebGLRenderer({ 
                    canvas: this.canvas, 
                    alpha: true, 
                    antialias: true 
                });
                this.renderer.setSize(this.canvas.offsetWidth, this.canvas.offsetHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                this.renderer.outputEncoding = THREE.sRGBEncoding;
                this.renderer.toneMapping = THREE.ACESFilmicToneMapping;
                this.renderer.toneMappingExposure = 1;
                
                // Lighting
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                this.scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(1, 1, 0.5);
                this.scene.add(directionalLight);
                
                const pointLight = new THREE.PointLight(0x7cfc00, 0.5, 10);
                pointLight.position.set(0, 2, 2);
                this.scene.add(pointLight);
                
                // Handle window resize
                window.addEventListener('resize', () => this.handleResize());
            }

            loadModel() {
                const loadingIndicator = document.getElementById('loadingIndicator');
                loadingIndicator.classList.add('show');
                
                // Check if GLTFLoader is available
                if (typeof THREE.GLTFLoader === 'undefined') {
                    console.error('GLTFLoader not found. Trying alternative approach...');
                    // Try using the global GLTFLoader if available
                    if (typeof GLTFLoader !== 'undefined') {
                        const loader = new GLTFLoader();
                        this.loadWithLoader(loader, loadingIndicator);
                    } else {
                        this.handleLoadError('GLTFLoader not available', loadingIndicator);
                    }
                    return;
                }
                
                const loader = new THREE.GLTFLoader();
                this.loadWithLoader(loader, loadingIndicator);
            }

            loadWithLoader(loader, loadingIndicator) {
                console.log('Attempting to load 3D model:', this.modelUrl);
                
                loader.load(
                    this.modelUrl,
                    (gltf) => {
                        console.log('3D model loaded successfully:', gltf);
                        this.model = gltf.scene;
                        
                        // Center and scale the model
                        const box = new THREE.Box3().setFromObject(this.model);
                        const center = box.getCenter(new THREE.Vector3());
                        const size = box.getSize(new THREE.Vector3());
                        
                        console.log('Model size:', size);
                        console.log('Model center:', center);
                        
                        // Scale to fit in view
                        const maxDim = Math.max(size.x, size.y, size.z);
                        const scale = maxDim > 0 ? 2 / maxDim : 1;
                        this.model.scale.setScalar(scale);
                        
                        // Center the model
                        this.model.position.sub(center.multiplyScalar(scale));
                        
                        // Ensure the model is visible
                        this.model.traverse((child) => {
                            if (child.isMesh) {
                                child.castShadow = true;
                                child.receiveShadow = true;
                                // Make sure materials are visible
                                if (child.material) {
                                    child.material.transparent = false;
                                    child.material.opacity = 1;
                                }
                            }
                        });
                        
                        this.scene.add(this.model);
                        this.isLoaded = true;
                        
                        loadingIndicator.classList.remove('show');
                        console.log('3D model added to scene and animation started');
                        this.animate();
                    },
                    (progress) => {
                        // Loading progress
                        const percent = Math.round((progress.loaded / progress.total) * 100);
                        console.log('Loading progress:', percent + '%');
                        loadingIndicator.innerHTML = `<div class="spinner"></div>Loading 3D Model... ${percent}%`;
                    },
                    (error) => {
                        this.handleLoadError(error, loadingIndicator);
                    }
                );
            }

            handleLoadError(error, loadingIndicator) {
                console.error('Error loading 3D model:', error);
                console.log('Model URL attempted:', this.modelUrl);
                
                // Create a fallback cube so we can see something is working
                const geometry = new THREE.BoxGeometry(1, 1.5, 0.1);
                const material = new THREE.MeshPhongMaterial({ 
                    color: 0x7cfc00,
                    transparent: true,
                    opacity: 0.8
                });
                this.model = new THREE.Mesh(geometry, material);
                this.scene.add(this.model);
                this.isLoaded = true;
                
                loadingIndicator.innerHTML = '<div style="color: #ff4444; font-size: 12px;">3D model failed to load<br>Using fallback cube<br>Check console for details</div>';
                
                setTimeout(() => {
                    loadingIndicator.classList.remove('show');
                    this.animate();
                }, 3000);
            }

            animate() {
                if (!this.isLoaded) return;
                
                this.animationId = requestAnimationFrame(() => this.animate());
                
                const elapsedTime = this.clock.getElapsedTime();
                
                if (this.model) {
                    // Gentle rotation and floating animation
                    this.model.rotation.y = elapsedTime * 0.3;
                    this.model.position.y += Math.sin(elapsedTime * 2) * 0.01;
                    
                    // Add slight tilt for visual interest
                    this.model.rotation.x = Math.sin(elapsedTime) * 0.1;
                    this.model.rotation.z = Math.cos(elapsedTime * 0.7) * 0.05;
                }
                
                this.renderer.render(this.scene, this.camera);
            }

            handleResize() {
                if (!this.camera || !this.renderer) return;
                
                const width = this.canvas.offsetWidth;
                const height = this.canvas.offsetHeight;
                
                this.camera.aspect = width / height;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(width, height);
            }

            destroy() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
                if (this.renderer) {
                    this.renderer.dispose();
                }
                if (this.scene) {
                    this.scene.clear();
                }
            }

            // Animation for pack opening
            startOpeningAnimation() {
                if (!this.model) return;
                
                // Animate the model during pack opening
                const startTime = this.clock.getElapsedTime();
                const animateOpening = () => {
                    const elapsed = this.clock.getElapsedTime() - startTime;
                    
                    if (elapsed < 1.2) { // Match the CSS animation duration
                        // Spin faster and scale up
                        this.model.rotation.y = elapsed * 10;
                        this.model.rotation.x = elapsed * 8;
                        this.model.rotation.z = elapsed * 6;
                        
                        const scale = 1 + elapsed * 2;
                        this.model.scale.setScalar(scale);
                        
                        // Fade out
                        if (this.model.material) {
                            this.model.traverse((child) => {
                                if (child.material) {
                                    child.material.opacity = Math.max(0, 1 - elapsed);
                                    child.material.transparent = true;
                                }
                            });
                        }
                        
                        requestAnimationFrame(animateOpening);
                    }
                };
                animateOpening();
            }
        }